# StrongSwan IPSec Configuration
# /etc/ipsec.conf equivalent for SecureConnect VPN

config setup
    # Basic StrongSwan configuration
    strictcrlpolicy=no
    uniqueids=yes
    charondebug="ike 2, knl 2, cfg 2, net 2, esp 2, dmn 2, mgr 2"

# Connection configuration for SecureConnect VPN clients
conn secureconnect-client
    # Connection type and mode
    type=tunnel
    keyexchange=ikev2
    fragmentation=yes
    forceencaps=yes
    
    # Left side (VPN Server)
    left=%any                           # Server's public IP (auto-detect)
    leftid=@secureconnect.vpn          # Server identity
    leftsubnet=0.0.0.0/0               # Traffic to route through VPN
    leftcert=server-cert.pem           # Server certificate
    leftkey=server-key.pem             # Server private key
    leftsendcert=always                # Always send certificate
    
    # Right side (VPN Client)
    right=%any                         # Accept connections from any IP
    rightid=%any                       # Accept any client identity
    rightsourceip=10.10.10.0/24       # IP pool for VPN clients
    rightdns=8.8.8.8,8.8.4.4          # DNS servers for clients
    
    # Authentication and encryption
    authby=pubkey                      # Use public key authentication
    eap_identity=%identity             # EAP identity
    
    # IKE (Internet Key Exchange) proposal
    ike=aes256-sha256-modp2048!        # Strong encryption
    
    # ESP (Encapsulating Security Payload) proposal
    esp=aes256-sha256-modp2048!        # Strong encryption for data
    
    # Connection behavior
    auto=add                           # Load connection but don't start
    closeaction=restart                # Restart on unexpected close
    dpdaction=restart                  # Dead peer detection action
    dpddelay=30s                       # DPD delay
    dpdtimeout=120s                    # DPD timeout
    
    # Rekeying
    keylife=1h                         # Key lifetime
    rekeymargin=3m                     # Rekey margin
    keyingtries=3                      # Key exchange attempts
    
    # Additional security
    compress=no                        # Disable compression (security)
    mobike=no                          # Disable MOBIKE for simplicity

# Connection for pre-shared key authentication (alternative)
conn secureconnect-psk
    type=tunnel
    keyexchange=ikev2
    
    # Left side (Server)
    left=%any
    leftid=@secureconnect.vpn
    leftsubnet=0.0.0.0/0
    leftauth=psk
    
    # Right side (Client)
    right=%any
    rightid=%any
    rightsourceip=10.10.10.0/24
    rightdns=8.8.8.8,8.8.4.4
    rightauth=psk
    
    # Encryption
    ike=aes256-sha256-modp2048!
    esp=aes256-sha256-modp2048!
    
    # Connection behavior
    auto=add
    closeaction=restart
    dpdaction=restart
    dpddelay=30s
    dpdtimeout=120s
    
    # Rekeying
    keylife=1h
    rekeymargin=3m
    keyingtries=3
